import{d as Q,r as p,A as j,o as H,a as c,q as t,s as o,x as n,O as J,P as K,w as W,G as X,C,F,f as D,z,t as E,b as k,e as v,p as I,Q as Y,R as Z,S as h,l as i,_ as ee}from"./index-qxG7-ExM.js";const le={class:"card-header"},ae={key:0,class:"hint"},te=Q({__name:"UsersView",setup(oe){const V=p(!1),g=p([]),U=p([]),u=p(!1),d=p("create"),y=p(null),e=j({username:"",password:"",email:"",display_name:"",is_active:!0,roles:[]});async function b(){V.value=!0;try{const[s,l]=await Promise.all([J(),K()]);g.value=s.users,U.value=l.roles}finally{V.value=!1}}function N(){d.value="create",y.value=null,e.username="",e.password="",e.email="",e.display_name="",e.is_active=!0,e.roles=[],u.value=!0}function R(s){d.value="edit",y.value=s.id,e.username=s.username,e.password="",e.email=s.email??"",e.display_name=s.display_name??"",e.is_active=s.is_active,e.roles=[...s.roles],u.value=!0}async function S(){if(d.value==="create")await Y({username:e.username,password:e.password,email:e.email||void 0,display_name:e.display_name||void 0,is_active:e.is_active,roles:e.roles});else if(d.value==="edit"&&y.value!=null){const s={email:e.email||void 0,display_name:e.display_name||void 0,is_active:e.is_active,roles:e.roles};e.password&&(s.password=e.password),await Z(y.value,s)}u.value=!1,await b()}async function B(s){await h(s.id),await b()}const x={admin:"#FF7C7C",operator:"#2DFEFF",viewer:"#ffe47c",default:"#ffffff"};function A(s){return{backgroundColor:x[s]||x.default,color:"#000000"}}return H(()=>{b()}),(s,l)=>{const _=n("el-button"),r=n("el-table-column"),T=n("el-table"),$=n("el-card"),w=n("el-input"),m=n("el-form-item"),M=n("el-option"),P=n("el-select"),q=n("el-switch"),G=n("el-form"),L=n("el-dialog"),O=X("loading");return i(),c("div",null,[t($,null,{header:o(()=>[k("div",le,[l[9]||(l[9]=k("span",null,"用户管理",-1)),t(_,{type:"primary",size:"small",onClick:N},{default:o(()=>[...l[8]||(l[8]=[v("新建用户",-1)])]),_:1})])]),default:o(()=>[W((i(),C(T,{data:g.value,style:{width:"100%"},stripe:""},{default:o(()=>[t(r,{prop:"username",label:"用户名","min-width":"120"}),t(r,{prop:"display_name",label:"显示名","min-width":"120"}),t(r,{prop:"email",label:"邮箱","min-width":"160"}),t(r,{label:"角色","min-width":"160"},{default:o(({row:a})=>[(i(!0),c(F,null,D(a.roles,f=>(i(),c("span",{key:f,class:"cli-tag",style:z(A(f))},E(f.toUpperCase()),5))),128))]),_:1}),t(r,{label:"状态",width:"100"},{default:o(({row:a})=>[k("span",{class:"cli-tag",style:z({backgroundColor:a.is_active?"#7CFF7C":"#d0d7de",color:"#000000"})},E(a.is_active?"ACTIVE":"INACTIVE"),5)]),_:1}),t(r,{label:"操作",width:"180"},{default:o(({row:a})=>[t(_,{type:"primary",link:"",size:"small",onClick:f=>R(a)},{default:o(()=>[...l[10]||(l[10]=[v("编辑",-1)])]),_:1},8,["onClick"]),t(_,{type:"danger",link:"",size:"small",onClick:f=>B(a)},{default:o(()=>[...l[11]||(l[11]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,V.value]])]),_:1}),t(L,{modelValue:u.value,"onUpdate:modelValue":l[7]||(l[7]=a=>u.value=a),title:d.value==="create"?"新建用户":"编辑用户",width:"520px"},{footer:o(()=>[t(_,{onClick:l[6]||(l[6]=a=>u.value=!1)},{default:o(()=>[...l[12]||(l[12]=[v("取消",-1)])]),_:1}),t(_,{type:"primary",onClick:S},{default:o(()=>[...l[13]||(l[13]=[v("保存",-1)])]),_:1})]),default:o(()=>[t(G,{"label-width":"90px"},{default:o(()=>[d.value==="create"?(i(),C(m,{key:0,label:"用户名"},{default:o(()=>[t(w,{modelValue:e.username,"onUpdate:modelValue":l[0]||(l[0]=a=>e.username=a),autocomplete:"off"},null,8,["modelValue"])]),_:1})):I("",!0),t(m,{label:"密码"},{default:o(()=>[t(w,{modelValue:e.password,"onUpdate:modelValue":l[1]||(l[1]=a=>e.password=a),type:"password",autocomplete:"new-password"},null,8,["modelValue"]),d.value==="edit"?(i(),c("div",ae,"留空则不修改密码")):I("",!0)]),_:1}),t(m,{label:"显示名"},{default:o(()=>[t(w,{modelValue:e.display_name,"onUpdate:modelValue":l[2]||(l[2]=a=>e.display_name=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(m,{label:"邮箱"},{default:o(()=>[t(w,{modelValue:e.email,"onUpdate:modelValue":l[3]||(l[3]=a=>e.email=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(m,{label:"角色"},{default:o(()=>[t(P,{modelValue:e.roles,"onUpdate:modelValue":l[4]||(l[4]=a=>e.roles=a),multiple:"",placeholder:"选择角色",style:{width:"100%"}},{default:o(()=>[(i(!0),c(F,null,D(U.value,a=>(i(),C(M,{key:a.id,label:a.display_name||a.name,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"状态"},{default:o(()=>[t(q,{modelValue:e.is_active,"onUpdate:modelValue":l[5]||(l[5]=a=>e.is_active=a),"active-text":"启用","inactive-text":"停用"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}}),ne=ee(te,[["__scopeId","data-v-bffd924d"]]);export{ne as default};
